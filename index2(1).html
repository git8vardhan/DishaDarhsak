<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='utf-8' />I
    <title>Disha-darshak</title>
    <meta name='viewport' content='width=device-width, initial-scale=1' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js'></script>
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=0R7m1GyK"></script>

    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css' rel='stylesheet' />
    
    <link href="style1.css"rel="stylesheet">
    
  </head>
  <body>
    <section id="sec">
      <div id='first'>DISHADARSHAK</div>
      <div id="destination-input">
        <label for="destination">Destination:</label>
        <input type="text" id="destination" placeholder="Enter destination...">
        <button onclick="handleEnter()" class="button">Click Me</button>
        <select id="voiceselection"></select> 
        <input onclick="responsiveVoice.speak($('#text1').val(),$('#voiceselection').val());" class="button" type="button" value="Read this for me" />
      </div>
      <div id="second">
        <div id='map'></div>
        <div id="instructions">
          <textarea id="text1" cols="45" rows="3"></textarea>
        </div>
      </div>
    </section>

    <script>
      var coordinates = [
    {
      'location': "Tilak Hall",
      'coordinates': {
        'latitude': 16.84447392564328,
        'longitude': 74.6013,
      }
    },
    {
      'location': "Girls Hostel D1",
      'coordinates': {
        'latitude': 16.845227537328523,
        'longitude': 74.60337065402615,
      }
    },
    {
      'location': "Girls Hostel D2",
      'coordinates': {
        'latitude': 16.844706861911785,
        'longitude': 74.60322749141903,
      }
    },
    {
      'location': "Girls Hostel D3",
      'coordinates': {
        'latitude': 16.8443,
        'longitude': 74.6033384455943,
      }
    },
    {
      'location': "Girls Hostel D4",
      'coordinates': {
        'latitude': 16.8442,
        'longitude': 74.6039,
      }
    },
    {
      'location': "Girls Hostel New Block",
      'coordinates': {
        'latitude': 16.844531026155174,
        'longitude': 74.6040727962217,
      }
    },
    {
      'location': "Girls Mess",
      'coordinates': {
        'latitude': 16.845104019426294,
        'longitude': 74.6041557358569,
      }
    },
    {
      'location': "Girls Hostel Ground",
      'coordinates': {
        'latitude': 16.844590905176183,
        'longitude': 74.6036460933663,
      }
    },
    {
      'location': "Boys Hostel D5",
      'coordinates': {
        'latitude': 16.842705432380296,
        'longitude': 74.60353009135154,
      }
    },
    {
      'location': "Boys Hostel D6",
      'coordinates': {
        'latitude': 16.842842042453725,
        'longitude': 74.60294185916858,
      }
    },
    {
      'location': "Boys Hostel D7",
      'coordinates': {
        'latitude': 16.843276272960416,
        'longitude': 74.6028562924814,
      }
    },
    {
      'location': "Boys Hostel D8",
      'coordinates': {
        'latitude': 16.84389230311316,
        'longitude': 74.60301165145485,
      }
    },
    {
      'location': "Boys Mess",
      'coordinates': {
        'latitude': 16.843111941859522,
        'longitude': 74.60370468998971,
      }
    },
    {
      'location': "Boys Hostel Ground",
      'coordinates': {
        'latitude': 16.843816705757483,
        'longitude': 74.60370468998971,
      }
    },
    {
      'location': "Dean Home",
      'coordinates': {
        'latitude': 16.845578870422237,
        'longitude': 74.60340658150228,
      }
    },
    {
      'location': "Girls Gym",
      'coordinates': {
        'latitude': 16.84526821845155,
        'longitude': 74.6027417031203,
      }
    },
    {
      'location': "Lipton",
      'coordinates': {
        'latitude': 16.844515520758502,
        'longitude': 74.6023266506143,
      }
    },
    {
      'location': "Polytechnic Wing (Old TPO Center)",
      'coordinates': {
        'latitude': 16.844262146439725,
        'longitude': 74.60238244321374,
      }
    },
    {
      'location': "Examination Cell",
      'coordinates': {
        'latitude': 16.8440,
        'longitude': 74.6021,
      }
    },
    {
      'location': "Boys Gym",
      'coordinates': {
        'latitude': 16.843716850929678,
        'longitude': 74.60155482214037,
      }
    },
    {
      'location': "College Canteen",
      'coordinates': {
        'latitude': 16.843294904497075,
        'longitude': 74.60190077429458,
      }
    },
    {
      'location': "WCE Playground",
      'coordinates': {
        'latitude': 16.84274039777835,
        'longitude': 74.60088423990001,
      }
    },
    {
      'location': "Badminton Court(Vartak Hall)",
      'coordinates': {
        'latitude': 16.843785624676713,
        'longitude': 74.60118630342279,
      }
    },
    {
      'location': "Basketball Ground",
      'coordinates': {
        'latitude': 16.8440,
        'longitude': 74.6009,
      }
    },
    {
      'location': "Volleyball Ground",
      'coordinates': {
        'latitude': 16.8440,
        'longitude': 74.6006,
      }
    },
    {
      'location': "Open Gym",
      'coordinates': {
        'latitude': 16.843930176878484,
        'longitude': 74.60124051995253,
      }
    },
    {
      'location': "Saraswati Idol",
      'coordinates': {
        'latitude': 16.844111793590876,
        'longitude': 74.60177881264056,
      }
    },
    {
      'location': "Library",
      'coordinates': {
        'latitude': 16.8444588986742,
        'longitude': 74.60189588675641,
      }
    },
    {
      'location': "Girls Study Room",
      'coordinates': {
        'latitude': 16.844771568707266,
        'longitude': 74.6019844046356,
      }
    },
    {
      'location': "Boys Study Room",
      'coordinates': {
        'latitude': 16.844950004981985,
        'longitude': 74.60203361678015,
      }
    },
    {
      'location': "Ganapati Temple",
      'coordinates': {
        'latitude': 16.844968668111587,
        'longitude': 74.60181911877326,
      }
    },
    {
      'location': "Cyber Hostel",
      'coordinates': {
        'latitude': 16.8454,
        'longitude': 74.60227,
      }
    },
    {
      'location': "Computer Science Department(CSE)",
      'coordinates': {
        'latitude': 16.845569648477777,
        'longitude': 74.60211719021883,
      }
    },
    {
      'location': "Mini CCF(Advanced Software Engineering Lab)",
      'coordinates': {
        'latitude': 16.84554654445449,
        'longitude': 74.60217753991674,
      }
    },
    {
      'location': "PG Wing",
      'coordinates': {
        'latitude': 16.8435,
        'longitude': 74.6020,
      }
    },
    {
      'location': "Parking",
      'coordinates': {
        'latitude': 16.84582604739841,
        'longitude': 74.60226440655009,
      }
    },
    {
      'location': "Administration Complex",
      'coordinates': {
        'latitude': 16.845719600805086,
        'longitude': 74.6013038047814,
      }
    },
    {
      'location': "Electronics Department",
      'coordinates': {
        'latitude': 16.845578353549495,
        'longitude': 74.60164037833627,
      }
    },
    {
      'location': "Information Technology Department(IT)",
      'coordinates': {
        'latitude': 16.8456,
        'longitude': 74.6008,
      }
    },
    {
      'location': "Central Computing Facility(CCF)",
      'coordinates': {
        'latitude': 16.8456,
        'longitude': 74.6003,
      }
    },
    {
      'location': "Physics Department",
      'coordinates': {
        'latitude': 16.8456,
        'longitude': 74.6003,
      }
    },
    {
      'location': "Sagar Canteen",
      'coordinates': {
        'latitude': 16.8456,
        'longitude': 74.5999,
      }
    },
    {
      'location': "Chemistry Department",
      'coordinates': {
        'latitude': 16.8456,
        'longitude': 74.6003,
      }
    },
    {
      'location': "Workshop Lab",
      'coordinates': {
        'latitude': 16.84588763591952,
        'longitude': 74.60001187655678,
      }
    },
    {
      'location': "Mechanical Department",
      'coordinates': {
        'latitude': 16.8455,
        'longitude': 74.6007,
      }
    },
    {
      'location': "Electrical Department",
      'coordinates': {
        'latitude': 16.8452,
        'longitude': 74.6015,
      }
    },
    {
      'location': "Academic Complex",
      'coordinates': {
        'latitude': 16.844805497799555,
        'longitude': 74.60103578618397,
      }
    },
    {
      'location': "Sathe Hall",
      'coordinates': {
        'latitude': 16.84438495145323,
        'longitude': 74.60145942205779,
      }
    },
    {
      'location': "Open Theatre",
      'coordinates': {
        'latitude': 16.844605596962225,
        'longitude': 74.60057865352012,
      }
    },
    {
      'location': "Civil Department",
      'coordinates': {
        'latitude': 16.84448412326796,
        'longitude': 74.60002470445043,
      }
    },
    {
      'location': "Fluid Mechanics Lab",
      'coordinates': {
        'latitude': 16.844564943992054,
        'longitude': 74.60021519398555,
      }
    },
    {
      'location': "Drawing Hall",
      'coordinates': {
        'latitude': 16.844318722608687,
        'longitude': 74.6001837730313,
      }
    },
    {
      'location': "Main Gate",
      'coordinates': {
        'latitude': 16.845958588002887,
        'longitude': 74.6025947958536,
      }
    },
    {
      'location': "Back Gate",
      'coordinates': {
        'latitude': 16.845867043371165,
        'longitude': 74.59908366365381,
      }
    },
    {
      'location': "WCE Track",
      'coordinates': {
        'latitude': 16.8436,
        'longitude': 74.6014,
      }
    },
    {
      'location': "Despensary",
      'coordinates': {
        'latitude': 16.84505258044768,
        'longitude': 74.60263441476849,
      }
    },
    {
      'location': "Central Store",
      'coordinates': {
        'latitude': 16.8452,
        'longitude': 74.6025,
      }
    },
    {
      'location': "Rector Office",
      'coordinates': {
        'latitude': 16.84472142160615,
        'longitude': 74.60248421107595,
      }
    },
    {
      'location': "Walchand Informatics Center(TPO Office)",
      'coordinates': {
        'latitude': 16.8446,
        'longitude': 74.6022,
      }
    },
    {
      'location': "Kalangan",
      'coordinates': {
        'latitude': 16.8457,
        'longitude': 74.6005,
      }
    },
    {
      'location': "Kalasadan",
      'coordinates': {
        'latitude': 16.8443,
        'longitude': 74.6013,
      }
    },
  ];
  function findCoordinates(locationName) {
    var lowerCaseName = locationName.toLowerCase();

    for (var i = 0; i < coordinates.length; i++) {
        var lowerCaseLocation = coordinates[i].location.toLowerCase();
        if (lowerCaseLocation === lowerCaseName) {
            return coordinates[i].coordinates;
        }
    }
    // Return null if location not found
    return null;
}
    </script>

<script src="https://code.responsivevoice.org/responsivevoice.js?key=0R7m1GyK"></script>

<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>


    <script>
      // add the JavaScript here
      mapboxgl.accessToken = 'pk.eyJ1Ijoic2FuaWthMTgiLCJhIjoiY2xvZmJ1Z2NvMG1nOTJxcWUxanp0ZmZzZCJ9.PG06PrqWVeTPhPXMyu3gmQ';
      const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/sanika18/cloiqfooc001q01nzf9wt5zb8',
        center: [74.60177881264056, 16.844111793590876], // Default starting position
        zoom: 5
      });

      // set the bounds of the map
      const bounds = [
        [74.480000, 16.842154],
        [74.603202, 16.855555]
      ];
      map.setMaxBounds(bounds);

      let start; // User's current location

      // Get the user's current location
      navigator.geolocation.getCurrentPosition((position) => {
        start = [position.coords.longitude, position.coords.latitude];
        map.setCenter(start);
        // Add starting point to the map
        map.addLayer({
          id: 'point',
          type: 'circle',
          source: {
            type: 'geojson',
            data: {
              type: 'FeatureCollection',
              features: [
                {
                  type: 'Feature',
                  properties: {},
                  geometry: {
                    type: 'Point',
                    coordinates: start
                  }
                }
              ]
            }
          },
          paint: {
            'circle-radius': 10,
            'circle-color': '#3887be'
          }
        });
      });


      function handleEnter() {
        var locationName = document.getElementById("destination").value;
        var coordinates = findCoordinates(locationName);
        var end = [coordinates.longitude, coordinates.latitude];
        getRoute(end);
        document.getElementById("destination").value = "";
      }



      function updateInstructions(instructionText) {
        const instructionsTextarea = document.getElementById('text1');
        instructionsTextarea.value = instructionText;
      }


      // Function to make a directions request
      async function getRoute(end) 
      {
        // console.log(end + " I");
        
        console.log(end);
        // console.log(locationName);
        // var coordinatesInJavaScript = window.coordinates;
        // console.log(coordinates);
        // Make a directions request using cycling profile
        const query = await fetch(
          `https://api.mapbox.com/directions/v5/mapbox/walking/${start[0]},${start[1]};${end[0]},${end[1]}?steps=true&geometries=geojson&access_token=${mapboxgl.accessToken}`,
          { method: 'GET' }
        );
        const json = await query.json();
        const data = json.routes[0];
        const route = data.geometry.coordinates;
        const geojson = {
          type: 'Feature',
          properties: {},
          geometry: {
            type: 'LineString',
            coordinates: route
          }
        };
        // If the route already exists on the map, reset it using setData
        if (map.getSource('route')) {
          map.getSource('route').setData(geojson);
        } else {
          map.addLayer({
            id: 'route',
            type: 'line',
            source: {
              type: 'geojson',
              data: geojson
            },
            layout: {
              'line-join': 'round',
              'line-cap': 'round'
            },
            paint: {
              'line-color': '#3887be',
              'line-width': 5,
              'line-opacity': 0.75
            }
          });
        }
        

        const instructions = document.getElementById('instructions');
        const steps = data.legs[0].steps;
        let tripInstructions = '';
        for (const step of steps) {
          tripInstructions += `<li>${step.maneuver.instruction}</li>`;
        }
        instructions.innerHTML = `<p><strong>Trip duration: ${Math.floor(
          data.duration / 60
        )} min ðŸš¶ </strong></p><ol>${tripInstructions}</ol>`;

        // Update instructions in the textarea
        updateInstructions(`<p><strong>Trip duration: ${Math.floor(data.duration / 60)} min ðŸš¶ </strong></p><ol>${tripInstructions}</ol>`);
      
      }

      // Event listener for map click
      map.on('click', (event) => {
        const coords = Object.keys(event.lngLat).map((key) => event.lngLat[key]);
        const end = {
          type: 'FeatureCollection',
          features: [
            {
              type: 'Feature',
              properties: {},
              geometry: {
                type: 'Point',
                coordinates: coords
              }
            }
          ]
        };
        if (map.getLayer('end')) {
          map.getSource('end').setData(end);
        } else {
          map.addLayer({
            id: 'end',
            type: 'circle',
            source: {
              type: 'geojson',
              data: {
                type: 'FeatureCollection',
                features: [
                  {
                    type: 'Feature',
                    properties: {},
                    geometry: {
                      type: 'Point',
                      coordinates: coords
                    }
                  }
                ]
              }
            },
            paint: {
              'circle-radius': 10,
              'circle-color': '#f30'
            }
          });
        }
        getRoute(coords);
      });

      

    </script>

<script>
  //Populate voice selection dropdown
  var voicelist = responsiveVoice.getVoices();
  var vselect = $("#voiceselection");
  $.each(voicelist, function() {
          vselect.append($("<option />").val(this.name).text(this.name));
  });
</script>
  </body>
</html>
